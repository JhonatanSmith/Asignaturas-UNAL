---
title: "Get Started"
output: flexdashboard::flex_dashboard
---

```{r setup, include = F, message = F}
if(!require(pacman)){install.packages("pacman"); library(pacman)}
pacman::p_load("tidyverse", "ggplot2", "pBrackets", "knitr", "HH", "car", "rgl","latex2exp","magrittr","ICSNP","rrcov",
              "Hotelling","biotools", "sampling","biotools","flexdashboard","MASS","mvtnorm","MVN")
source("funciones.R", local = knitr::knit_global())
#source("Functions.R", local = knitr::knit_global())
```

**PH $\boldsymbol{\Sigma}=\boldsymbol{\Sigma}_0$**
=========================================

Column 1 pag 1
--------------------------------------------------

### **Generación de Datos Normales Bivariados**

```{r}
alfa<-c(0.05)
mu=c(0,0)
sigma<-matrix(c(4,-3,-3,4),ncol=2)
#datos<-round(mvrnorm(n=100, mu,sigma),3)
#datos6<-read.table("G:\\Mi unidad\\1_A_A_CURSOS_UNAL\\1_MULTIVARIADO\\2022_I\\tableros_IAM\\datos\\datos6.txt",header=TRUE)
datos6 <- read.table("datos6.txt",header=TRUE)
datos6$Grupos %<>% as.factor()
grupo1<-datos6 %>% filter(Grupos=="1")
grupo2<-datos6 %>% filter(Grupos=="2")
grupo3<-datos6 %>% filter(Grupos=="3")
xbar<-apply(grupo1[,1:2], 2, mean)
xvar<-var(grupo1[,1:2])
ybar<-apply(grupo2[,1:2], 2, mean)
yvar<-var(grupo2[,1:2])
Sigma_0<-matrix(c(6.5, -0.05, -2.5,-0.05, 5.5, 0.5, -2.5 ,0.5, 7.5),byrow=TRUE,ncol=3)
```

**Datos Generados de una Normal Bivariada con parámetros**:
$$
\underline{\mu}=\begin{bmatrix} `r mu[1]` \\ `r mu[2]`  \end{bmatrix} \ \ \ \ \ y \ \ \ \ \boldsymbol{\Sigma}=\begin{bmatrix} `r sigma[1,1]` & `r sigma[1,2]` \\ `r sigma[2,1]` & `r sigma[2,2]` \end{bmatrix} $$

**Las estimaciones muestrales de los parámetros son**:
$$
\underline{\overline{x}}=\begin{bmatrix} \overline{x}_1 \\ \overline{x}_2  \end{bmatrix}= \begin{bmatrix} `r  round(xbar[1],3)` \\ `r round(xbar[2],3)`  \end{bmatrix} \ \ \ \ \ y \ \ \ \ \boldsymbol{S}_x=\begin{bmatrix} s_{11} & s_{12} \\ s_{21} & s_{22} \end{bmatrix} =  \begin{bmatrix} `r round(xvar[1,1],3)` & `r round(xvar[1,2],3)` \\ `r round(xvar[2,1],3)` & `r round(xvar[2,2],3)` \end{bmatrix} 
$$
**Se tiene interés en la siguiente PH**:
$$
\begin{cases}
H_0 \  : \ \boldsymbol{\Sigma} = \boldsymbol{\Sigma}_0 \\
H_a \  : \ \boldsymbol{\Sigma} \neq \boldsymbol{\Sigma}_0 \\
\end{cases}
$$
donde, $\boldsymbol{\Sigma}_0$-es una matriz de valores fijos  conocida para $\boldsymbol{\Sigma}$ (usualmente planteada por experiencia previa). 

**La estadística de Razón de Verosimilitud para la PH considerada está dado por**:
$$
\lambda= \frac { \underset{\underline{\boldsymbol{\mu}}}{\text{Máx}} \ \  L(\underline{\mu} \ , \ \boldsymbol{\Sigma}_0 ) } { \underset{\boldsymbol{ \underline{\mu} \ ,\ \Sigma}}{\text{Máx}} \ \ L(\underline{\mu} \ , \ \boldsymbol{\Sigma} ) } =\left[ \left( \frac{n-1}{n} \right)^p \frac{|\boldsymbol{S}|}{|\boldsymbol{\Sigma}_0|}   \right]^{\frac{n}{2}}\text{Exp}\biggl\{-\frac{1}{2} \left[(n-1)\text{tr}(\boldsymbol{S}\boldsymbol{\Sigma}_0^{-1} ) -np  \right] \biggr\} 
$$

haciendo: $\frac{n-1}{n} \approx 1$, ie. $n-1 \approx n = v$, ie. $v=n-1=n$, se tiene: 
$$
\lambda= \frac{|\boldsymbol{S}|^{\frac{v}{2}}}{|\boldsymbol{\Sigma}_0|^{\frac{v}{2}}}  \text{Exp}\left\{-\frac{1}{2} \left[v \text{tr}(\boldsymbol{S}\boldsymbol{\Sigma}_0^{-1} ) -vp  \right] \right\} 
$$ 
$$
\lambda^\star = -2\text{log}\lambda= v \left[ \text{Log}|\boldsymbol{\Sigma}_0| -  \text{Log}|\boldsymbol{S}| + \text{tr}(\boldsymbol{S}\boldsymbol{\Sigma}_0^{-1} ) -p \right]\ 
$$ 
**Alternativamente, si $\lambda_1,\lambda_2,\ldots,\lambda_p$ son los valores propios de $\boldsymbol{S\Sigma_0^{-1}}$, entonces se tiene que**: 
$$
\lambda^\star = v \left[ \sum_{i=1}^p [\lambda_i -\text{Log} \lambda_i ] -p \right]
$$
$$
\lambda^\star \sim \chi_{k}^2 \  , \ \ para \  \ \ n-1\ \  grande
$$
con $k=p+\frac{p(p+1)}{2}-p=\frac{p(p+1)}{2}$.

**Rechazamos** $H_0$ si. $\lambda^\star > \chi_{\alpha\ ;\ k}^2$

**Una Modificación para** $\lambda^\star$-**fue propuesta por Bartlet, para el caso de muestras pequeñas** la cual es:
$$
\lambda_1^\star = c \lambda^\star=\left\{1- \frac{1}{6(n-1)}\left[2p+1-\frac{2}{p+1}\right]  \right\} \lambda^\star \sim \chi_{k}^2 
$$
**que puede usarse para tamaños de muestras moderadamente pequeños**.


Column 2 pag 1 
--------------------------------------------------

### **Prueba de Hipótesis: $H_0 \ : \  \boldsymbol{\Sigma}=\boldsymbol{\Sigma}_0$ $n$-grande**

Se desea contrastar las hipótesis:
$$
 H_0 \ : \ \boldsymbol{\Sigma}=\boldsymbol{\Sigma}_0=\begin{bmatrix} 
`r Sigma_0[1,1]`  & `r Sigma_0[1,2]` & `r Sigma_0[1,3]`\\ `r Sigma_0[2,1]` & `r Sigma_0[2,2]` & `r Sigma_0[2,3]` \\ `r Sigma_0[3,1]` & `r Sigma_0[3,2]` & `r Sigma_0[3,3]`
\end{bmatrix}
$$ 
a un nivel de significancia del $5\%$.

```{r echo = TRUE}
res_sigma0<-sigma_sigma0_ngrande(grupo1[,1:3],Sigma_0,0.05) 
kable(res_sigma0)
```

### **Prueba de Hipótesis: $H_0 \ : \  \boldsymbol{\Sigma}=\boldsymbol{\Sigma}_0$ $n$-pequeña**

```{r echo = TRUE}
res_sigma0npqna<-sigma_sigma0_npqna(grupo1[,1:3],Sigma_0,0.05) 
kable(res_sigma0npqna)
```

**PH $\boldsymbol{\Sigma}_1=\boldsymbol{\Sigma}_2$**
=================================================

Column 1 pag 2
--------------------------------------------------

### **PH $\boldsymbol{\Sigma}_1=\boldsymbol{\Sigma}_2$ M de Box**

**Datos Generados de una Normal Bivariada con parámetros**:
$$
\underline{\mu}=\begin{bmatrix} `r mu[1]` \\ `r mu[2]`  \end{bmatrix} \ \ \ \ \ y \ \ \ \ \boldsymbol{\Sigma}=\begin{bmatrix} `r sigma[1,1]` & `r sigma[1,2]` \\ `r sigma[2,1]` & `r sigma[2,2]` \end{bmatrix} $$

**Las estimaciones muestrales de los parámetros son**:
$$
\underline{\overline{x}}_1=\begin{bmatrix} \overline{x}_1 \\ \overline{x}_2  \end{bmatrix}= \begin{bmatrix} `r  round(xbar[1],3)` \\ `r round(xbar[2],3)`  \end{bmatrix} \ \ \ \ \ y \ \ \ \ \boldsymbol{S}_1=\begin{bmatrix} s_{11} & s_{12} \\ s_{21} & s_{22} \end{bmatrix} =  \begin{bmatrix} `r round(xvar[1,1],3)` & `r round(xvar[1,2],3)` \\ `r round(xvar[2,1],3)` & `r round(xvar[2,2],3)` \end{bmatrix} 
$$
$$
\underline{\overline{x}}_2=\begin{bmatrix} \overline{x}_1 \\ \overline{x}_2  \end{bmatrix}= \begin{bmatrix} `r  round(ybar[1],3)` \\ `r round(ybar[2],3)`  \end{bmatrix} \ \ \ \ \ y \ \ \ \ \boldsymbol{S}_2=\begin{bmatrix} s_{11} & s_{12} \\ s_{21} & s_{22} \end{bmatrix} =  \begin{bmatrix} `r round(yvar[1,1],3)` & `r round(yvar[1,2],3)` \\ `r round(yvar[2,1],3)` & `r round(yvar[2,2],3)` \end{bmatrix} 
$$
**Se desea realizar la siguiente prueba de hipótesis**:
$$
\begin{cases}
H_0 \ : \ \boldsymbol{\Sigma}_1=\boldsymbol{\Sigma}_2=\boldsymbol{\Sigma}\\
H_a \ : \ \boldsymbol{\Sigma}_1 \neq  \boldsymbol{\Sigma}_2
\end{cases}
$$
donde $\boldsymbol{\Sigma}$-es una matriz de Var-Cov común desconocida. 

**La estadístico de razón de verosimilitud para esta PH es**:
$$
\lambda= \prod_{i=1}^g \left( \frac{|\boldsymbol{S}_i|}{|\boldsymbol{S}_p|} \right)^{\frac{n_i-1}{2}}, \ \ \text{con:}\ \ \ \ \boldsymbol{S}_p=\frac{1}{v} \left[\sum_{i=1}^g v_i \boldsymbol{S}_i \right], \ \ v_i=n_i-1
$$
**La Estadística M de Box se define como**:  
$$
M=-2\text{Log} \lambda= v \text{Log}|\boldsymbol{S}_p|-\sum_{i=1}^g v_i\text{Log}|\boldsymbol{S}_i| \sim \chi^2_k, \ \ \  k=\frac{p(p+1)(g-1)}{2}
$$
**Ahora, para $n$-pequeña se tiene**: 
$$
C=(1-u)M \ \ \underset{\longrightarrow}{d} \ \ \chi_{k}^2 \  ,\ \ \ \text{con:} \ \ \ u=\left[\sum_{i=1}^g\frac{1}{v_i} -\frac{1}{v}\right]\bigg(\frac{2p^2+3p-1}{6(p+1)(g-1)} \biggr)
$$
Se rechaza $H_0$, si $C > \chi_{\alpha \ ; \ k}^2$   (**Se puede usar para $n_i>20$ y con $p$ y $g$-no mayores a 5**).


Column 2 pag 2 
--------------------------------------------------

### **Prueba de Hipótesis: $H_0 \ : \  \boldsymbol{\Sigma}_1=\boldsymbol{\Sigma}_2$**

```{r echo=TRUE}
res_box<-prueba_M_Box2(grupo1[,1:3],grupo2[,1:3],0.05)
kable(res_box)
```

### **Prueba de Hipótesis: $H_0 \ : \  \boldsymbol{\Sigma}_1=\boldsymbol{\Sigma}_2$ utilizando la función ``boxM``**.

```{r echo=TRUE}
(mbox<-boxM(datos6[1:55,1:3],datos6$Grupos[1:55]) )
#(boxM(rbind(grupo1[,1:3],grupo2[,1:3]),datos6$Grupos[1:55]) )
```





