---
title: ""
author: ""
date: ""
output: pdf_document
---

**Pruebas de hipotesis para** $\mu$ **cuando** $\Sigma$ **es desconocida**
*POBLACION NORMAL, PEQUEÑA*

```{r}
## Función para la PH de mu=mu_0-pob. Normal
HT2_mu0=function(x,mu_0,alfa){
  mu=apply(x,2,mean);s=var(x)          
  n=nrow(x);p=ncol(x)         
  df1=p;df2=n-p           
  T2<-n*t(mu-mu_0)%*%solve(s)%*%(mu-mu_0)   
  k<-( (n-1)*p )/(n-p)
  F0<-(1/k)*T2 
  F_tabla=qf(1-alfa,df1,df2) 
  kf=k*F_tabla
  valor_p=1-pf(F0,df1,df2)
  resultados=list(Media=mu,T2=T2,K=k,F0=F0,df1=df1,df2=df2,
                  F_Tabla=F_tabla,kf=kf,Valor_p=valor_p) 
  resultados
}
```

```{r,results="asis",echo = T,message=FALSE}
vector_1 <- c(6,9)
vector_2 <- c(10,6)
vector_3 <- c(8,3)
x <- rbind(vector_1, vector_2, vector_3)
e1=9
e2=5
mu=rbind(e1,e2)
mu
res_mu0<-HT2_mu0(x,mu,0.05)
```

\begin{tabular}{cccccccc}
$T2$ & $K$ & $F_0$ & $df_1$ & $df_2$ & $F_{Tabla}$ & $kf$ &  Valor-$p$ \\\hline
`r res_mu0[2]`&`r res_mu0[3]` &`r res_mu0[4]`&`r res_mu0[5]`&`r res_mu0[6]`&`r res_mu0[7]` &  `r res_mu0[8]`&  `r res_mu0[9]`
\end{tabular}
\newline \newline

**Prueba de hipotesis**
$$H_0: \mu=\mu_o$$ $$vs$$ $$H_a: \mu\neq \mu_o$$
Se rechaza $H_0$ si T2>kf o si $F_0$>Ftabla


```{r include = F}
library(ICSNP)
library(rrcov)
```

**otras opciones**

```{r}
## recordar que T2 es Fo## 
HotellingsT2(x,mu=mu)
T2.test(x,mu=mu)
```
**Pruebas de hipotesis para** $\mu$ **cuando** $\Sigma$ **es conocida y cuando n es GRANDE**


```{r}
HT2_mu0_ngrande=function(x,mu_0,alfa){
  mu=apply(x,2,mean);s=var(x)          
  n=nrow(x);p=ncol(x)         
  df=p
  chi_2<-n*t(mu-mu_0)%*%solve(s)%*%(mu-mu_0)   
  chi_tabla=qchisq(1-alfa,df)     
  valor_p=1-pchisq(chi_2,df)
  resultados=list(Media=mu,Chi_2=chi_2,df=df,Chi_Tabla=chi_tabla,
                  Valor_p=valor_p) 
  resultados
}

res_mu0ngrande<-HT2_mu0_ngrande(x,mu,0.05)
```

\begin{center}
\begin{tabular}{cccc}
$\chi_0^2$ & $df$ & $\chi_{Tabla}$ &  Valor-$p$ \\\hline
`r res_mu0ngrande[2]`&`r res_mu0ngrande[3]` &`r res_mu0ngrande[4]`&`r res_mu0ngrande[5]`
\end{tabular}
\end{center}


Se rechaza $H_0$ si chi2 > chitabla

**otras opciones**
```{r}
HotellingsT2(x, mu = mu, test = "chi")
```
**Prueba de hipotesis para** $\Sigma$

Se desea contrastar la hipotesis

$$H_0:\Sigma=\Sigma_0$$ $$H_a:\Sigma\neq\Sigma_0$$


```{r}
##muestras grandes
sigmaigualsigma=function(sigma,alfa,n,p){
  v=n
  dete=det(sigma)
  inversa=solve(sigma)
  tras=tr(s*inversa)
  lamda= v*(log(dete)-log(det(t))+tras-p)
  df=(p*(p+1))/2
  chi_tabla=qchisq(1-alfa,df)
  resultados=list(Lamda=lamda,df=df,Chi_Tabla=chi_tabla)
}
##se rechaza Ho si lamda>chitabla
```

```{r}
sigma_sigma0_npqña=function(x,Sigma_0,alfa){
  x=as.matrix(x)
  Sigma=as.matrix(Sigma_0)
  p=ncol(x);n=nrow(x) 
  S=var(x) 
  ## Construcción del Estadístico de Prueba
  mesa=S%*%solve(Sigma_0)
  lamda_est= n*sum( diag(mesa) ) - n*log( det(S) ) + 
    n*log( det(Sigma_0) ) - n*p
  c<-1- ( 1/( 6*(n-1) ) )*( 2*p+1-( 2/(p+1) ) )
  lamda_1_est<-c*lamda_est
  df=0.5*p*(p+1)    
  chi_tabla=qchisq(1-alfa,df) 
  valor_p=1-pchisq(lamda_1_est,df) 
  result=list(Lamda1_est=lamda_1_est,df=df,
              Chi_Tabla=chi_tabla,Valor_P=valor_p) 
  result 
}
##se rechaza Ho si lamda1>chitabla
```

**Pruebas hipotesis para** $\Sigma_1=\Sigma_2=...=\Sigma$

se desea probar 

$H_0=\Sigma_1=\Sigma_2=...=\Sigma$ $vs$ $H_a\neq\Sigma_1=\Sigma_2=...=\Sigma$

```{r}
prueba_M_Box2=function(x,y,alfa){
  g<-2
  n=nrow(x);m=nrow(y);p=ncol(x) 
  s1=var(x);s2=var(y)       
  v<-n+m-2
  sp<-( (n-1)*s1+(m-1)*s2 )/v   
  M<-v*log( det(sp) )-( (n-1)*log( det(s1) ) + (m-1)*log( det(s2) ) )
  u<-( ( 1/(n-1) ) + ( 1/(m-1) ) - (1/v) )*( (2*p^2 + 3*p - 1)/(6*(p+1)*(g-1)) )
  c<-(1-u)*M
  df=( p*(p+1)*(g-1) )/2  # Grados de liber del num de la chi-cuadrado
  chi_tabla=qchisq(1-alfa,df) # Valor crítico de la chi o Chi-de la tabla
  valor_p=1-pchisq(c,df)  # valor-p de la prueba
  resultados=list(M=M,U=u,C=c,df=df,Chi_Tabla=chi_tabla,Valor_p=valor_p)
  }
```

```{r}
nh=c(271,138,107)
s1=array(c(0.291,0,0,0,
           -0.01,0.011,0,0,
           0.02,0.00,0.001,0,
           0.010,0.003,0.00,0.10),dim=c(4,4))
s1=s1+t(s1)-diag(diag(s1))
s2=array(c(0.561,0,0,0,
           0.011,0.025,0,0,
           0.001,0.004,0.005,0,
           0.037,0.007,0.002,0.019),dim=c(4,4))
s2=s2+t(s2)-diag(diag(s2))

s3=array(c(0.261,0,0,0,
           0.030,0.017,0,0,
           0.003,0.00,0.004,0,
           0.018,0.006,0.001,0.013),dim=c(4,4))
s3=s3+t(s3)-diag(diag(s3))
  


  g<-3
  p=4
  v<-sum(nh-1)
  vi=nh-1
  vi
  sp<- (1/v)*((vi[1]*s1)+(vi[2]*s2)+(vi[3]*s3)) 
  sp
  M<-v*log( det(sp) )-vi[1]*log(abs(det(s1)))-vi[2]*log(det(s2))-vi[3]*log(det(s3))
  u<- ( sum((1/vi)) - (1/v) ) *( (2*p^2 + 3*p - 1)/(6*(p+1)*(g-1)) )
  c<-(1-u)*M
  df=( p*(p+1)*(g-1) )/2  # Grados de liber del num de la chi-cuadrado
  chi_tabla=qchisq(1-0.05,df) # Valor crítico de la chi o Chi-de la tabla
  valor_p=1-pchisq(c,df)  # valor-p de la prueba
  ##se rechaza si C>chitabla##
```

**Pruebas de hipotesis para diferencia de medias normal-pequeña**
*CON SIGMA DESCONOCIDA*
$\Sigma1=\Sigma2$
se desea probar:
$$H_0=\mu_1-\mu_2=\delta$$vs$$H_0=\mu_1-\mu_2\neq\delta$$


```{r}
HT2_sigmas_iguales=function(x,y,mu_0,alfa){
  mux=apply(x,2,mean);muy=apply(y,2,mean) 
  sx<-var(x);sy<-var(y)          
  n=nrow(x);m=nrow(y);p=ncol(x)         
  df1=p;df2<-n+m-p-1 # Grados de libertad del num y denom de la F
  sp<-( (n-1)*sx + (m-1)*sy )/(n+m-2) 
  T_2<-( (n*m)/(n+m) )*t(mux-muy-mu_0)%*%solve(sp)%*%(mux-muy-mu_0) 
  k<-( (n+m-2)*p )/(n+m-p-1)
  F0<-(1/k)*T_2               # Estadística F_0=(1/k)T2
  F_tabla=qf(1-alfa,df1,df2)  # Valor crítico de la F o F-de la Tabla
  valor_p=1-pf(F0,df1,df2)    # valor-p de la prueba
  resultados<-list(Media_x=mux,Media_y=muy,T2=T_2,k=k,F0=F0,
                   df1=df1,df2=df2,F_Tabla=F_tabla,Valor_p=valor_p) 
  resultados
}
##se rechaza Ho si fo>ftabla##
```

```{r}
n=32
m=32
p=4
x=array(c(15.97,15.91,27.19,22.75),dim=c(4,1))
x
y=array(c(12.34,13.91,16.59,21.94),dim=c(4,1))
y
x-y
mu=array(c(0,0,0,0),dim=c(4,1))
sx=array(c(5.192,4.545,6.522,5.250,
           0,13.18,6.760,6.266,
           0,0,28.67,14.47,
           0,0,0,0.1665),dim=c(4,4))
sx=sx+t(sx)-diag(diag(sx))
sy=array(c(9.136,7.549,5.531,4.151,
           0,18.60,5.446,5.466,
           0,0,13.55,13.55,
           0,0,0,28.00),dim=c(4,4))
sy=sy+t(sy)-diag(diag(sy))
sp=array(c(7.164,6.047,6.027,4.701,
           0,15.89,6.103,5.866,
           0,0,21.11,14.01,
           0,0,0,22.325),dim=c(4,4))
sp=sp+t(sp)-diag(diag(sp))

df1=p;df2<-n+m-p-1
T_2<-(n*m/(n+m))*(t(x-y-mu))%*%(solve(sp))%*%(x-y-mu)
k<-( (n+m-2)*p )/(n+m-p-1)
  F0<-(1/k)*T_2               # Estadística F_0=(1/k)T2
  F_tabla=qf(1-0.05,df1,df2)  # Valor crítico de la F o F-de la Tabla
  valor_p=1-pf(F0,df1,df2)  
  
##se rechaza ho si F0>Ftabla##
```

**otras opciones**
HotellingsT2(x,y), libreria ICNP

**Pruebas de hipotesis para diferencia de medias N GRANDE**
*CON SIGMA DESCONOCIDA*
$\Sigma1=\Sigma2$
se desea probar:
$$H_0=\mu_1-\mu_2=\delta$$vs$$H_0=\mu_1-\mu_2\neq\delta$$
```{r}
HT2_sigmas_iguales_ngrande=function(x,y,mu_0,alfa){
  mux=apply(x,2,mean);muy=apply(y,2,mean) 
  sx<-var(x);sy<-var(y)          
  n=nrow(x);m=nrow(y);p=ncol(x)         
  df=p      # Grados de libertad de la chi-cuadrado
  sp<-( (n-1)*sx + (m-1)*sy )/(n+m-2) 
  chi_2<-( (n*m)/(n+m) )*t(mux-muy-mu_0)%*%solve(sp)%*%(mux-muy-mu_0) 
  chi_tabla=qchisq(1-alfa,df)  # Valor de la chi_cuadrado, ie. chi_Tabla
  valor_p=1-pchisq(chi_2,df)    # valor-p de la prueba
  resultados<-list(Media_x=mux,Media_y=muy,Chi2=chi_2,df=df,
                   Chi_Tabla=chi_tabla,Valor_p=valor_p) 
  resultados
}
##se rechaza Ho si chi2>chitabla##
```

**otras opciones**
HotellingsT2(x,y,test="chi"), libreria ICNP

**Pruebas de hipotesis para diferencia de medias normal-pequeña**
*CON SIGMA DESCONOCIDA*
$\Sigma1\neq\Sigma2$
se desea probar:
$$H_0=\mu_1-\mu_2=\delta$$vs$$H_0=\mu_1-\mu_2\neq\delta$$

```{r}
HT2_sigmas_diferentes=function(x,y,mu_0,alfa){
  mux=apply(x,2,mean);muy=apply(y,2,mean) 
  sx<-var(x);sy<-var(y)          
  n=nrow(x);m=nrow(y);p=ncol(x)         
  v1<-(1/n)*sx;v2<-(1/m)*sy
  se<-v1+v2
  v<-( sum(diag(se)) + 
         sum(diag(se))^2 )/( (1/(n-1))*(sum(diag(v1)) + 
                                          sum(diag(v1))^2) + ( 1/(m-1) )*(sum(diag(v2)) + 
                                                                            sum(diag(v2))^2) )
  v<-ceiling(v)   
  df1=p;df2<-v-p+1  # Grados de libertad de la F
  sp<-( (n-1)*sx + (m-1)*sy )/(n+m-2)
  T_2<-t(mux-muy-mu_0)%*%solve(se)%*%(mux-muy-mu_0)
  k<-(v*p)/(v-p+1)
  F0<-(1/k)*T_2
  F_tabla=qf(1-alfa,df1,df2)    
  valor_p=1-pf(F0,df1,df2)    
  resultados=list(Media_x=mux,Media_y=muy,T_2=T_2,v=v,k=k,F0=F0,
                  df1=df1,df2=df2,F_Tabla=F_tabla,Valor_p=valor_p) 
  resultados
}
##se rechaza Ho si Fo>ftabla##
```

**Pruebas de hipotesis para diferencia de medias NGRANDE**
*CON SIGMA DESCONOCIDA*
$\Sigma1\neq\Sigma2$
se desea probar:
$$H_0=\mu_1-\mu_2=\delta$$vs$$H_0=\mu_1-\mu_2\neq\delta$$

```{r}
chi_sigmas_diferentes=function(x,y,mu_0,alfa,s1,s2,n,m,p){
  se=(s1/n)+(s2/m)
  ch2=tra(x-y-mu_0)%*%solve(se)%*%(x-y-mu_0)
  chitabla=qchisq(1-alfa,p)
  resultados=list(se=se,chi2=ch2,chitabla=chitabla)
}

##se rechaza ho si chi2>chitabla##

```

