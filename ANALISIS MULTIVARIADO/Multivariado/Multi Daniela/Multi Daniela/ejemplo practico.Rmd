---
pdf_document: default
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

**introducción Al Análisis Multivariado - Punto Práctico\hspace{0.2cm}- Profesor: Raúl Alberto Peréz **
$\rule{6.6in}{1pt}$
**Daniela Pico Arredondo**
\vspace{0.5cm}

**Normalidad univariada para las variables 1, 2 y 3. En caso de no-Normalidad realizar una transformación de Box-Cox de ser posible**
\vspace{0.5cm}

```{r, echo=FALSE}
library(readr)
bdparcial <- read.csv("C:/Users/Usuario/Desktop/bdparcial.txt", sep=" ")
                      
View(bdparcial)
```
```{r, echo=FALSE}
attach(bdparcial)
```

```{r echo=FALSE,comment=FALSE,message=FALSE, include=FALSE}
library(ggplot2) 
library(ppcc)
library(kableExtra)
library(ggplot2) 
library(gdtools)
library(carData)
library(car)
library(ggplot2)
library(MVN)
```

\vspace{1cm}
\begin{center}
\textbf{Normalidad Univariada para X1}
\end{center}



```{r, echo=FALSE,results="asis",comment=FALSE,message=FALSE}
library(ggplot2) 
ejemplo<-data.frame(X1)

p<-ggplot(ejemplo, aes(sample = ejemplo[,1]) ) 
p + geom_qq() + geom_qq_line()+
#ggtitle("Normal Probaility Plot o QQ-plot") + 
         labs(title="Normal Probaility Plot o QQ-plot",
           x = "Valores Teóricos (Estadísticos de Orden)", 
              y = "Valores Muestrales (Quantiles)")+
  theme_bw() +
    theme(axis.text.x = element_text(colour = "grey20", size = 10, angle = 0,
                                     hjust = 0.5, vjust = 0.5),
          axis.text.y = element_text(colour = "grey20", size = 10),
          text = element_text(size = 12))+
  theme(
    panel.background = element_rect(fill = "#B983FF"),
    panel.grid.minor = element_line(linetype = "dotted")
  )
#ggsave("figuras/npp.pn
#qqnorm(ejemplo); qqline(ejemplo)

```
En la gráfica se observa un gran desajuste de los puntos con la recta, se observa una tendencia no lineal y las colas se alejan mucho de la ella, por lo tanto se concluye que la variable X1 no es normal, Se utilizaran los siguientes test para Apoyar la respuesta obtenida en el gráfico de dispersión

$$
H_0= X_1\sim Normal \hspace{0.5cm}vs\hspace{0.5cm} H_1=X_1\not\sim Normal$$


```{r, echo=FALSE,results="asis",comment=FALSE,message=FALSE}
cat("\n Resultados de la prueba de normalidad univariada vía la PH del coeficiente de Correlación:\n")
ppccTest(bdparcial$X1, "qnorm")
cat("\n Resultados de la prueba de normalidad univariada Test de Shapiro Wilk:\n")
shapiro.test(bdparcial$X1)
```

* La prueba de normalidad univariada del coeficiente de correlación se obtine un valor p-value= 2.2e-16<0.05, Por tanto se rechaza la hipotesis nula y se concluye que X1 no es normal

* La prueba de normalidad univariada test de Shapiro Wilk se obtiene un p-value=1.859e-05<0.05, Por tanto se rechaza la hipotesis nula y se conclute que X1 no es normal

Se decidió hacer una transformación Box Cox para normalizar las observaciones de la variable X1, se obtuvieron los siguientes resultados:

\vspace{1cm}

\begin{center}
\textbf{Datos transformados para X1}
\end{center}


```{r, echo=FALSE,results="asis",comment=FALSE,message=FALSE}

landa=powerTransform(bdparcial[,1])
landaf<-landa$lambda
xt<-data.frame((bdparcial[,1]^landaf-1)/landaf)
p<-ggplot(xt, aes(sample = xt[,1]) ) 
p + geom_qq() + geom_qq_line() + 
         labs(title="Normal Probaility Plot o QQ-plot",
           x = "Valores Teóricos (Estadísticos de Orden)", 
              y = "Valores Muestrales (Quantiles)")+
  theme_bw() +
    theme(axis.text.x = element_text(colour = "grey20", size = 10, angle = 0,
                                     hjust = 0.5, vjust = 0.5),
          axis.text.y = element_text(colour = "grey20", size = 10),
          text = element_text(size = 12))+
  theme(
    panel.background = element_rect(fill = "#B983FF"),
    panel.grid.minor = element_line(linetype = "dotted")
  )

shapiro.test(xt[,1])
```

De la gráfica de X1 transformada, considerando el 95% de los puntos del centro de la misma, observe que siguen la línea de referencia y no se alejan mucho de ella, por lo tanto se puede concluir que es normal. 

\newpage

\vspace{1cm}
\begin{center}
\textbf{Normalidad Univariada para X2}
\end{center}


```{r, echo=FALSE,results="asis",comment=FALSE,message=FALSE}
library(ggplot2) 
ejemplo2<-data.frame(bdparcial$X2)

p<-ggplot(ejemplo2, aes(sample = ejemplo2[,1]) ) 
p + geom_qq() + geom_qq_line()+
#ggtitle("Normal Probaility Plot o QQ-plot") + 
         labs(title="Normal Probaility Plot o QQ-plot",
           x = "Valores Teóricos (Estadísticos de Orden)", 
              y = "Valores Muestrales (Quantiles)")+
  theme_bw() +
    theme(axis.text.x = element_text(colour = "grey20", size = 10, angle = 0,
                                     hjust = 0.5, vjust = 0.5),
          axis.text.y = element_text(colour = "grey20", size = 10),
          text = element_text(size = 12))+
  theme(
    panel.background = element_rect(fill = "#B983FF"),
    panel.grid.minor = element_line(linetype = "dotted")
  )
#ggsave("figuras/npp.png")
#qqnorm(ejemplo); qqline(ejemplo)
```
De la gráfica, considerando el 95% de los puntos del centro de la misma, observe que siguen la línea de referencia y no se alejan mucho de ella, por lo tanto se puede concluir que la variable sigue una distribucción normal.

$$
H_0= X_2\sim Normal \hspace{0.5cm}vs\hspace{0.5cm} H_1=X_2\not\sim Normal$$


```{r, echo=FALSE,results="asis",comment=FALSE,message=FALSE}
cat("\n Resultados de la prueba de normalidad univariada vía la PH del coeficiente de Correlación:\n")
ppccTest(bdparcial$X2, "qnorm")
cat("\n Resultados de la prueba de normalidad univariada Test de Shapiro Wilk:\n")
shapiro.test(bdparcial$X2)
```

* La prueba de normalidad univariada del coeficiente de correlación se obtine un valor p-value= 0.9275>0.05, Por tanto no se rechaza la hipotesis nula y se concluye que X2 sigue una distribucción normal

* La prueba de normalidad univariada test de Shapiro Wilk se obtiene un p-value=0.85>0.05,Por tanto no se rechaza la hipotesis nula y se concluye que X2 sigue una distribucción normal

\vspace{1cm}
\begin{center}
\textbf{Normalidad univariada para X3}
\end{center}



```{r, echo=FALSE,results="asis",comment=FALSE,message=FALSE}
library(ggplot2) 
ejemplo3<-data.frame(bdparcial$X3)

p<-ggplot(ejemplo3, aes(sample = ejemplo3[,1]) ) 
p + geom_qq() + geom_qq_line()+
#ggtitle("Normal Probaility Plot o QQ-plot") + 
         labs(title="Normal Probaility Plot o QQ-plot",
           x = "Valores Teóricos (Estadísticos de Orden)", 
              y = "Valores Muestrales (Quantiles)")+
  theme_bw() +
    theme(axis.text.x = element_text(colour = "grey20", size = 10, angle = 0,
                                     hjust = 0.5, vjust = 0.5),
          axis.text.y = element_text(colour = "grey20", size = 10),
          text = element_text(size = 12))+
  theme(
    panel.background = element_rect(fill = "#B983FF"),
    panel.grid.minor = element_line(linetype = "dotted")
  )
#ggsave("figuras/npp.png")
#qqnorm(ejemplo); qqline(ejemplo)
```
De la gráfica, considerando el 95% de los puntos del centro de la misma, observe que siguen la línea de referencia y no se alejan mucho de ella, por lo tanto se puede concluir que la variable sigue una distribucción normal.

$$
H_0= X_3\sim Normal \hspace{0.5cm}vs\hspace{0.5cm} H_1=X_3\not\sim Normal$$


```{r, echo=FALSE,results="asis",comment=FALSE,message=FALSE}
cat("\n Resultados de la prueba de normalidad univariada vía la PH del coeficiente de Correlación:\n")
ppccTest(bdparcial$X3, "qnorm")
cat("\n Resultados de la prueba de normalidad univariada Test de Shapiro Wilk:\n")
shapiro.test(bdparcial$X3)
```

* La prueba de normalidad univariada del coeficiente de correlación se obtine un valor p-value= 0.9871>0.05, Por tanto no se rechaza la hipotesis nula y se concluye que X3 sigue una distribucción normal

* La prueba de normalidad univariada test de Shapiro Wilk se obtiene un p-value=0.992>0.05,Por tanto no se rechaza la hipotesis nula y se concluye que X3 sigue una distribucción normal

\vspace{1cm}

**Normalidad bivariada para las variables 1 con 2, la 2 con 3 y la 1 con 4**
\vspace{1cm}

\begin{center}
\textbf{X1 con X2}
\end{center}

```{r, echo=FALSE,results="asis",comment=FALSE,message=FALSE}
mvn(bdparcial[,c(1,2)],mvnTest=c("royston"),univariateTest=c("SW")) %>% 
kable(booktabs = TRUE,format = "latex",caption="\\label{ph-nm-royston}Salidas Básicas PH NM- Royston") %>%
  kable_styling(latex_options = c("striped", "condensed","HOLD_position"),
  position = "center",full_width = FALSE)
```
$$
H_0= \underline{X_1,X_2}\sim Normal \hspace{0.5cm}vs\hspace{0.5cm} H_1=\underline{X_1,X_2}\not\sim Normal$$

En la tabla 1, están las Salidas básicas de la función mvn usando la prueba multivariada de Royston que indican un valor-p=0.0001359<0.05 por tanto se rechaza la hipotesis nula y se concluye que no hay normalidad bivariada entre en X1 y X2, esto tiene sentido ya que X1 no es normal univariada. Además se visualiza el resumen de descriptivo de los datos.

Ahora veremos como se comporta la normalidad bivariada con X1 transformada
\vspace{1cm}
\begin{center}
\textbf{X1Transformada con X2}
\end{center}


```{r, echo=FALSE,results="asis",comment=FALSE,message=FALSE, include=FALSE}
library(dplyr)
library(MVN)
library(kableExtra)
transformacion<-rename(data.frame(xt,bdparcial$X2),"X1transform"="X.bdparcial...1..landaf...1..landaf","X2"="bdparcial.X2")
mvn(transformacion[,c(1,2)],mvnTest=c("royston"),univariateTest=c("SW")) %>% 
kable(booktabs = TRUE,format = "latex",caption="\\label{ph-nm-royston}Salidas Básicas PH NM- Royston") %>%
  kable_styling(latex_options = c("striped", "condensed","HOLD_position"),
  position = "center",full_width = FALSE)
```

```{r, echo=FALSE,results="asis",comment=FALSE,message=FALSE}

result2<-mvn(transformacion[,c(1,2)],mvnTest=c("royston"),univariateTest=c("SW"))
result2$multivariateNormality %>% 
kable(booktabs = TRUE,format = "latex",caption="Prueba de Normalidad Multivariada",align = c('c', 'r', 'r', 'c'), col.names = c("Prueba","Valor Estadística","Valor-p","Resultado"),row.names = TRUE,digits =c(0,5,5,0),format.args = list( decimal.mark = ".")) %>%
  kable_styling(latex_options = c("striped", "condensed","HOLD_position"),
  position = "center",full_width = FALSE)
```

```{r, echo=FALSE,results="asis",comment=FALSE,message=FALSE}
result2$univariateNormality %>%
kable(booktabs = TRUE,format = "latex",caption="Prueba de Normalidad Univariada", align = c('c', 'c', 'c', 'c', 'c'),
      col.names = c("Prueba","Variables","Valor Estadística","Valor-p","Resultado"),row.names = TRUE,digits =c(0,0,3,3,0),format.args = list( decimal.mark = ".")) %>%
  kable_styling(latex_options = c("striped", "condensed","HOLD_position"),
  position = "center",full_width = FALSE)
```


$$
H_0= \underline{X_1*,X_2}\sim Normal \hspace{0.5cm}vs\hspace{0.5cm} H_1=\underline{X_1*,X_2}\not\sim Normal$$

Según la prueba multivariada de Royston se observa un valor-p=0.88307>0.05,por lo tanto no se rechaza la hipotesis nula y  se concluye que hay normalidad bivariada entre en X1transformada y X2, esto tiene sentido ya que al transformar X1 se soluciono el problema de la normalidad univariada, aunque no siempre la normalidad univariada implica la normalidad multivariada.


\vspace{1cm}
\begin{center}
\textbf{X2 con X3}
\end{center}

```{r, echo=FALSE,results="asis",comment=FALSE,message=FALSE}
mvn(bdparcial[,c(2,3)],mvnTest=c("royston"),univariateTest=c("SW")) %>% 
kable(booktabs = TRUE,format = "latex",caption="\\label{ph-nm-royston}Salidas Básicas PH NM- Royston") %>%
  kable_styling(latex_options = c("striped", "condensed","HOLD_position"),
  position = "center",full_width = FALSE)
```

$$
H_0= \underline{X_2,X_3}\sim Normal \hspace{0.5cm}vs\hspace{0.5cm} H_1=\underline{X_2,X_3}\not\sim Normal$$

Según la prueba multivariada de Royston se obtiene un valor-p=0.982328>0.05, por tanto no se rechaza la hipotesis nula y concluye que hay normalidad bivariada entre en X2 y X3.
\vspace{1cm}

\begin{center}
\textbf{X1 con X4}
\end{center}


```{r, echo=FALSE,results="asis",comment=FALSE,message=FALSE}
mvn(bdparcial[,c(1,4)],mvnTest=c("royston"),univariateTest=c("SW")) %>% 
kable(booktabs = TRUE,format = "latex",caption="\\label{ph-nm-royston}Salidas Básicas PH NM- Royston") %>%
  kable_styling(latex_options = c("striped", "condensed","HOLD_position"),
  position = "center",full_width = FALSE)
```
$$
H_0= \underline{X_1,X_4}\sim Normal \hspace{0.5cm}vs\hspace{0.5cm} H_1=\underline{X_1,X_4}\not\sim Normal$$

Usando la prueba multivariada de Royston que indican un valor-p=0.0001205<0.05, por lo tanto se rechaza la hipotesis nula y se concluye que no hay normalidad bivariada entre en X1 y X4, esto tiene sentido ya que X1 no es normal univariada. Además se visualiza el resumen de descriptivo de los datos.

**Ahora veremos como se comporta la normalidad bivariada con X1 transformada**
\vspace{1cm}
\begin{center}
\textbf{X1Transformada con X4}
\end{center}


```{r, echo=FALSE,results="asis",comment=FALSE,message=FALSE, include=FALSE}
library(dplyr)
library(MVN)
library(kableExtra)
transformacion1<-rename(data.frame(xt,bdparcial$X4),"X1transform"="X.bdparcial...1..landaf...1..landaf","X4"="bdparcial.X4")
mvn(transformacion1[,c(1,2)],mvnTest=c("royston"),univariateTest=c("SW")) %>% 
kable(booktabs = TRUE,format = "latex",caption="\\label{ph-nm-royston}Salidas Básicas PH NM- Royston") %>%
  kable_styling(latex_options = c("striped", "condensed","HOLD_position"),
  position = "center",full_width = FALSE)
```

```{r, echo=FALSE,results="asis",comment=FALSE,message=FALSE}

result2<-mvn(transformacion[,c(1,2)],mvnTest=c("royston"),univariateTest=c("SW"))
result2$multivariateNormality %>% 
kable(booktabs = TRUE,format = "latex",caption="Prueba de Normalidad Multivariada",align = c('c', 'r', 'r', 'c'), col.names = c("Prueba","Valor Estadística","Valor-p","Resultado"),row.names = TRUE,digits =c(0,5,5,0),format.args = list( decimal.mark = ".")) %>%
  kable_styling(latex_options = c("striped", "condensed","HOLD_position"),
  position = "center",full_width = FALSE)
```

```{r, echo=FALSE,results="asis",comment=FALSE,message=FALSE}
result2$univariateNormality %>%
kable(booktabs = TRUE,format = "latex",caption="Prueba de Normalidad Univariada", align = c('c', 'c', 'c', 'c', 'c'),
      col.names = c("Prueba","Variables","Valor Estadística","Valor-p","Resultado"),row.names = TRUE,digits =c(0,0,3,3,0),format.args = list( decimal.mark = ".")) %>%
  kable_styling(latex_options = c("striped", "condensed","HOLD_position"),
  position = "center",full_width = FALSE)
```

$$
H_0= \underline{X_1*,X_4}\sim Normal \hspace{0.5cm}vs\hspace{0.5cm} H_1=\underline{X_1*,X_4}\not\sim Normal$$

Según la prueba multivariada de Royston se obtiene un valor-p=0.88307>0.05, por tanto no se rechaza la hipotesis nula y se  concluye que hay normalidad bivariada entre en X1transformada y X4, esto tiene sentido ya que al transformar X1 se soluciono el problema de la normalidad univariada, aunque no siempre la normalidad univariada  implica la normalidad multivariada.
\vspace{1cm}
\begin{center}
\textbf{Normal Trivariada X2,X3 y X4}
\end{center}



```{r, echo=FALSE,results="asis",comment=FALSE,message=FALSE}
mvn(bdparcial[,c(2,3,4)],mvnTest=c("royston"),univariateTest=c("SW")) %>% 
kable(booktabs = TRUE,format = "latex",caption="\\label{ph-nm-royston}Salidas Básicas PH NM- Royston") %>%
  kable_styling(latex_options = c("striped", "condensed","HOLD_position"),
  position = "center",full_width = FALSE)
```

\newpage
$$
H_0= \underline{X_2,X_3,X_4}\sim Normal \hspace{0.5cm}vs\hspace{0.5cm} H_1=\underline{X_2,X_3,X_4}\not\sim Normal$$

Según la prueba multivariada de Royston se obtiene un valor-p=0.9578078>0.05, por tanto no se rechaza la hipotesis nula y se concluye que hay normalidad bivariada entre en X2 y X3, Además se observa que X2, X3 y X4 son normales univaridas.

\vspace{1cm}
\begin{center}
\textbf{Normal Multivariada}
\end{center}

$$
H_0= \underline{X_1,X_2,X_3,X_4,X_5}\sim Normal \hspace{0.5cm}vs\hspace{0.5cm} H_1=\underline{X_1,X_2,X_3,X_4,X_5}\not\sim Normal$$


```{r, echo=FALSE,results="asis",comment=FALSE,message=FALSE}

result1<-mvn(bdparcial,mvnTest=c("mardia"),univariateTest=c("SW"))
result1$multivariateNormality %>%
kable(booktabs = TRUE,format = "latex",caption="\\label{nor-multiv}Prueba de Normalidad Multivariada",align = c('c', 'r', 'r', 'c'),col.names = c("Prueba","Valor Estadística","Valor-p","Resultado"),row.names = TRUE,digits =c(NA,5,5,NA)) %>% 
kable_styling(latex_options = c("striped", "condensed","HOLD_position"),
  position = "center", font_size=8,full_width = FALSE)
```
* En la prueba de normalidad multivariada Mardia-skewness se obtiene un p-value=0.00093890<0.05,Por tanto se rechaza la hipotesis nula y se concluye que el conjunto de datos no sigue una distribucción normal multivariada

En la tabla \ref{nor-univ}, se encuentran los resultados de las pruebas de normalidad univariadas para cada una de las variables del conjunto de datos p-variados.

```{r, echo=FALSE,results="asis",comment=FALSE,message=FALSE}
result1$univariateNormality %>%
kable(booktabs = TRUE,format = "latex", caption="\\label{nor-univ}Prueba de Normalidad Univariada", align = c('c', 'c', 'c'), col.names = c("Prueba","Variables","Valor Estadística","Valor-p","Resultado"),row.names = TRUE,digits =c(NA,NA,3,3,0),format.args = list( decimal.mark = ".")) %>%
  kable_styling(latex_options = c("striped", "condensed","HOLD_position"),
  position = "center", full_width = FALSE)
```

```{r, echo=FALSE,results="asis",comment=FALSE,message=FALSE}
mvn(bdparcial[,c(1,2,3,4,5)],mvnTest=c("royston"),univariateTest=c("SW")) %>% 
kable(booktabs = TRUE,format = "latex",caption="\\label{ph-nm-royston}Salidas Básicas PH NM- Royston") %>%
  kable_styling(latex_options = c("striped", "condensed","HOLD_position"),
  position = "center",full_width = FALSE)
```

Usando la prueba multivariada de Royston que indican un valor-p=0<0.05, por lo tanto se rechaza la hipotesis nula y se concluye que no hay normalidad Multivariada entre en X1,X2,X3 X4, esto tiene sentido ya que X1 y X5 no son normales univariadas. 

**Test de Shapiro Wilk Multivariada**

```{r echo=FALSE, message=FALSE, comment=FALSE, results="asis"}
library(RVAideMemoire)
mshapiro.test(bdparcial)

```

* La prueba de Shapiro Wilk indica que p-value=3.57e07<0.05 por lo tanto se rechaza la hipotesis nula y se concluye que no hay normalidad multivariada

\vspace{1cm}

**Test de shapiro wilk multivariada con X1 transformada**

Se quiere ver el comportamiento de la normalidad multivariada si se usara la transformación en la variada X1

```{r echo=FALSE, message=FALSE, comment=FALSE, results="asis"}
library(dplyr)
transformacion2<-rename(data.frame(xt,bdparcial$X2,bdparcial$X3,bdparcial$X4,bdparcial$X5),"X1transform"="X.bdparcial...1..landaf...1..landaf","X2"="bdparcial.X2","X3"="bdparcial.X3","X4"="bdparcial.X4","X5"="bdparcial.X5")
library(RVAideMemoire)
mshapiro.test(transformacion2)

```

* La prueba de Shapiro Wilk indica que p-value=0.02743<0.05 por lo tanto se rechaza la hipotesis nula y se concluye que no hay normalidad multivariada, claramente se ve que la transformación de X1 no es suficiente para asegurar la normalidad multivariada entre las variables, esto debido a que X5 no es normal univariada.

```{r echo=FALSE, message=FALSE, comment=FALSE, results="asis"}
library(ggplot2)
mqqnorm(bdparcial,main="Gráfico QQ-Plot para Normalidad Multivariada")
```

Se observa que los puntos no caen en una lınea recta de pendiente 1. Por
lo que no se apoya la normalidad Multivariada en estos datos


