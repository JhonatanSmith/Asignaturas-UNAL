---
author: "Nombre Completo Autor"
date: "27/10/2017"
documentclass: book
forprint: true  # true: imprime a dos caras, false: libro digital
fontsize: 12pt # 10pt,11pt
geometry: margin = 2.5cm 
bibliography: ["bib/library.bib", "bib/paquetes.bib"]
# metodobib -> true: natbib (descomentar: citation_package: natbib) 
#           -> false: pandoc (comentar: citation_package: natbib)
metodobib: true
#natbib: plainnat, abbrvnat, unsrtnat
biblio-style: "plainnat"
#Método 2 (pandoc): descomente una línea de las 2 siguientes en caso de usarlo
csl: methods-in-ecology-and-evolution.csl      # no numera mejor en las citas
#csl: acm-sig-proceedings-long-author-list.csl  # numera peor en las citas
link-citations: yes
output: 
  pdf_document:
    keep_tex: no
    number_sections: yes
    citation_package: natbib  # comentado usa: pandoc-citeproc
    #toc: yes
    fig_caption: yes
    template: latex/plantilla_trabajos.tex
    includes:
      #before_body: portadas/latex_paginatitulo_modTFE.tex
      #in_header: latex/latex_preambulo.tex
      #after_body: latex/latex_antes_enddoc.tex
---



```{r include=FALSE}
knitr::opts_chunk$set(fig.path = 'figurasR/',
                      echo = FALSE, warning = FALSE, message = FALSE,
                      fig.pos="H",fig.align="center",out.width="95%",
                      cache=FALSE)
```

```{r setup, include = F, message = F}
if(!require(pacman)){install.packages("pacman"); library(pacman)}
pacman::p_load("tidyverse", "ggplot2", "pBrackets", "knitr", "HH", "car", "rgl", "sampling")
source("funcionesR/funciones.R", local = knitr::knit_global())
```


<!-- \setcounter{chapter}{2} -->
<!-- \setcounter{chapter}{2} escribir 2 para capítulo 3  -->
<!-- \pagenumbering{arabic} -->

\ifdefined\ifprincipal
\else
\setlength{\parindent}{1em}
\pagestyle{fancy}
\setcounter{tocdepth}{4}
\tableofcontents
<!-- \nocite{*} -->
\fi

\ifdefined\ifdoblecara
\fancyhead{}{}
\fancyhead[LE,RO]{\scriptsize\rightmark}
\fancyfoot[LO,RE]{\scriptsize\slshape \leftmark}
\fancyfoot[C]{}
\fancyfoot[LE,RO]{\footnotesize\thepage}
\else
\fancyhead{}{}
\fancyhead[RO]{\scriptsize\rightmark}
\fancyfoot[LO]{\scriptsize\slshape \leftmark}
\fancyfoot[C]{}
\fancyfoot[RO]{\footnotesize\thepage}
\fi
\renewcommand{\headrulewidth}{0.4pt}
\renewcommand{\footrulewidth}{0.4pt}


# Gráficos Bivariados Varios

## Función R que representa datos bivariados, junto con elipses de confianza

Con esta función se realzia un gráfico de dispersión de dos variables junto con dos elipses de confianza del $(1-\alpha_1)100\%$ y $(1-\alpha_2)100\%$. El centro de la elipse está representado por un punto de color azul.

```{r, echo=FALSE}
library(MASS)
library(mvtnorm)
library(MVN)

par(mfrow=c(2,2))
mu=c(2,2)

mu=c(2,2)
sigma<-matrix(c(5,4,4,5),ncol=2)
datos2<-round(mvrnorm(n=100, mu,sigma),3)
representa2(datos2,0.9,0.95,"(a) Normales")   

mu=c(0,0)
sigma<-matrix(c(3,0,0,3),ncol=2)
datos2<-round(mvrnorm(n=100, mu,sigma),3)
representa2(datos2,0.5,0.95,"(a) Normales")   

mu=c(2,0)
sigma<-matrix(c(5,-4,-4,5),ncol=2)
datos2<-round(mvrnorm(n=100, mu,sigma),3)
representa2(datos2,0.5,0.95,"(a) Normales")   

mu=c(0,2)
sigma<-matrix(c(5,-4,-4,10),ncol=2)
datos2<-round(mvrnorm(n=100, mu,sigma),3)
representa2(datos2,0.5,0.95,"(a) Normales")  
```

## Función R que representa datos bivariados, junto con el vector de medias

```{r, echo=FALSE}
par(mfrow=c(2,2))
mu=c(2,2)

mu=c(2,2)
sigma<-matrix(c(5,4,4,5),ncol=2)
datos2<-round(mvrnorm(n=100, mu,sigma),3)
representa1(datos2,0.95,"(a) Normales")   

mu=c(0,0)
sigma<-matrix(c(3,0,0,3),ncol=2)
datos2<-round(mvrnorm(n=100, mu,sigma),3)
representa1(datos2,0.5,"(a) Normales")   

mu=c(2,0)
sigma<-matrix(c(5,-4,-4,5),ncol=2)
datos2<-round(mvrnorm(n=100, mu,sigma),3)
representa1(datos2,0.85,"(a) Normales")   

mu=c(0,2)
sigma<-matrix(c(5,-4,-4,10),ncol=2)
datos2<-round(mvrnorm(n=100, mu,sigma),3)
representa1(datos2,0.9,"(a) Normales")  
```

##  Grafica de Superficies de Normaales Bivariadas 

```{r, echo=FALSE}
media <- c(5, 5)
varianza <- matrix(c(2, 0, 0, 2), ncol=2)
library(clusterGeneration)  ### package clusterGeneration, para generar MSDP ###
#sigma<-genPositiveDefMat("eigen",dim=2)$Sigma      

x <- seq(from=0, to=10, length.out=60)
y <- seq(from=0, to=10, length.out=60)

fun <- function(x, y) dmvnorm(c(x, y), mean=media, sigma=varianza)
fun <- Vectorize(fun)
z <- outer(x, y, fun)

media1 <- c(5, 5)
varianza1 <- matrix(c(1.3, 1, 1, 1.3), ncol=2)

fun1 <- function(x, y) dmvnorm(c(x, y), mean=media1, sigma=varianza1)
fun1 <- Vectorize(fun1)
z1 <- outer(x, y, fun1)

par(mfrow=c(1, 2), mar=c(1, 1, 1, 2))
persp(x, y, z, theta=-10, phi=20, expand=0.8, axes=FALSE,box=F)
persp(x, y, z1, theta=-10, phi=20, expand=0.8, axes=FALSE,box=F)

media2 <- c(5, 5)
varianza2 <- matrix(c(1.3, -1, -1, 1.3), ncol=2)

fun2 <- function(x, y) dmvnorm(c(x, y), mean=media2, sigma=varianza2)
fun2 <- Vectorize(fun2)
z2 <- outer(x, y, fun2)

par(mfrow=c(1, 2), mar=c(1, 1, 1, 2))
persp(x, y, z2, theta=-10, phi=20, expand=0.8, axes=FALSE,box=F)
persp(x, y, z1, theta=-10, phi=20, expand=0.8, axes=FALSE,box=F)
```

### Varios Ejemplos de Perpectivas 

```{r, echo=FALSE,results="asis",comment=FALSE,message=FALSE}
x<-seq(-4,4,len=50)
y<-seq(-4,4,len=50)

normal.bivariada<-function(x,y,rho,mu1,sigma1,mu2,sigma2){
1/(2*pi*sigma1*sigma2*sqrt(1-rho^2))*exp(-1/(2*(1-rho^2))*
(((x-mu1)/sigma1)^2-2*rho*((x-mu1)/sigma1)*((y-mu2)/sigma2)+
((y-mu2)/sigma2)^2))
}

f<-outer(x,y,normal.bivariada,rho=0.5,mu1=0,sigma1=2^0.5,mu2=2,sigma2=1)

#### Inicio de Gráfico matrix 2x2
nf<-layout(matrix(c(1,2,3,4),ncol=2,byrow=T),widths=c(rep(12,4)),heights=c(rep(12,2)),respect=T)

library(latex2exp)
par(mar=c(1,1,4,1))
persp(x,y,f,theta = 30, phi = 30, col = "lightblue",xlab = "X", ylab = "Y", zlab = "Z",
  main = TeX('$\\rho=0.5$, \ $\\mu_1=0$, \ $\\mu_2=2$, \ $\\sigma_1=\\sqrt{2}$, \ $\\sigma_2=1$') , cex.main=0.8)

par(mar=c(1,1,4,1)) 
persp(x,y,f,theta = -10, phi = 30, col = "lightblue", xlab = "X", ylab = "Y", zlab ="Z",main="rho=0.5",cex.main=0.8)

par(mar=c(1,1,4,1))
persp(x,y,f,theta = 30, phi = 0, col = "lightblue",xlab = "X", ylab = "Y", zlab ="Z",main="rho=0.5",cex.main=0.8)

par(mar=c(1,1,4,1))
persp(x,y,f,theta = 0, phi = -40, col = "lightblue",xlab = "X", ylab = "Y", zlab ="Z",main="rho=0.5",cex.main=0.8)
```

##  Grafica de Contornos de Superficies de Normaales Bivariadas                            
```{r, echo=FALSE,results="asis",comment=FALSE,message=FALSE}
x<-seq(0,10,len=60)
y<-seq(0,10,len=60)

media <- c(5, 5)
varianza <- matrix(c(1.3, 1, 1, 1.3), ncol=2)

fun <- function(x, y) dmvnorm(c(x, y), mean=media, sigma=varianza)
fun <- Vectorize(fun)

z<-outer(x,y,fun)

par(mfrow=c(1,2))
persp(x, y, z, theta=-10, phi=20, expand=0.8, axes=FALSE,box=F)

contour(x,y,z, nlevels=3,levels=c(0.01,0.05,0.1),labels=c(0.01,0.05,0.1),lwd=1.5,xlab=expression(x[1]),ylab=expression(x[2]),main="Contornos de verosimilitud del 90%,95% y 99%",cex.main=0.85)
```

## Prueba de Normalidad del Coeficiente de Correlación, Ejemplo de notas de Clase

```{r, echo=FALSE,results="asis",comment=FALSE,message=FALSE}
ejemplo<-c(-1,-0.10,0.16,0.41,0.62,0.80,1.26,1.54,1.71,2.30)
#kable(ejemplo,caption="Datos")

qqnorm(ejemplo); qqline(ejemplo)

library(ppcc)
ppccTest(ejemplo, "qnorm")
#ppccTest(ejemplo)
```

### Ejemplo de Notas de Clases (Manual)

```{r, echo=FALSE,results="asis",comment=FALSE,message=FALSE}
n<-length(ejemplo)
pj<-round((1:n-0.5)/n,3)
qj<-round(qnorm(pj),3)
r<-cor(qj,sort(ejemplo))
cat("\n El Coeficiente de Correlación es:\ \ \n")
r
cat("\n El Valor tabulado en la tabla es:\ \ R(n,alpha)=R(10,0.05)=0.9351 \n")
cat("\n Como r>T-tabulado, luego no se rechaza H0 \n")
```







