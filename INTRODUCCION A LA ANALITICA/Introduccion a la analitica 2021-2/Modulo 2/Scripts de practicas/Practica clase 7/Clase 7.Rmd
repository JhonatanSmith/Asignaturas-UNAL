---
title: "Practica clase 7"
author: "Jhonatan Smith Garcia"
date: "9/1/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```




```{r}
require(ISLR)

mod1<-lm(wage ~ poly(age,degree = 4), data=Wage)
fit1<-mod1$fitted.values
Wage$wage2<-ifelse(Wage$wage>250,1,0)
mod2<-glm(wage2~ poly(age, degree=4), data=Wage, family=binomial(link = "logit"))
fit2<-mod2$fitted.values
```


```{r}
par(mfrow=c(1,2))
plot(Wage$age, Wage$wage, pch=19, col="gray")
lines(sort(Wage$age), fit1[order(Wage$age)], col=4, lwd=2)

plot(sort(Wage$age), fit2[order(Wage$age)], col=4, lwd=2, type="l", ylim=c(0, 0.2), 
     xlab="Age", ylab="Pr(Wage>250)")

```


Se busca el mejor polinomio para predecir Wage con los datos. Se utilizará un polinomio para predecir. Empiricamente, se prueba hasta grado 4 del polinomio, de la siguiente manera.

# Con validacion Cruzada:

Se busca explicar la tendencia con el mejor polinomio posible.Se quiere ajustar varios polinomios:


```{r}
require(boot) # Paquete para hacer validacion cruzada
mod1 = glm(wage ~ poly(age,1), data = Wage) # Polinomio grado 1

```

Se procede a analizar y aplicar validacion cruzada a los modelos:

```{r}
cv.error1 = cv.glm(Wage, mod1, K=10) # CV con K-fold
cv.error1$delta # on los valores del estimador de prueba k-fol, se usa el primer valor.
```
Se supone que el valor a usar será 1675.049

*Para un polinomio de grado 2 hasta 4*

```{r}
mod2 = glm(wage ~ poly(age, 2), data = Wage)
cv.err2 <- cv.glm(Wage, mod2, K =10)
cv.err2$delta[1]
```
```{r}
mod3 = glm(wage ~ poly(age, 3), data = Wage)
cv.err3 <- cv.glm(Wage, mod2, K =10)
cv.err3$delta[1]
```
```{r}
mod4 = glm(wage ~ poly(age, 4), data = Wage)
cv.err4 <- cv.glm(Wage, mod2, K =10)
cv.err4$delta[1]
```

En este caso, el mejor polinomio a usar será el de grado 2.  

# graficando los datos con el polinomio

```{r}
fit2 <- mod2$fitted.values # Valores ajustados mod 2

plot(Wage$age, Wage$wage, pch = 19, col = "gray")
lines(sort(Wage$age), fit2[order(Wage$age)], col = 4, lwd =2)

```


Este es el mejor polinomio que interpola a los datos segun validacion cruzada

# Creacion del segundo grafico

Se crea una nueva variable en la base de datos. La variable será llamada wage 2 y es para separar entre 0 y 1

```{r}
Wage$wage2 <- ifelse(Wage$wage>250, 1,0) # Si se cmple, coloque 1, caso contrario, 0 

```

El modelo a crear es un modelo de tip logistico

```{r}
modelo2 = glm(wage2~ poly(age, degree = 2), data = Wage , family = binomial(link = "logit"))
fitted1 = modelo2$fitted.values #Razon de ods
```

```{r}
fitted1[1:5]
```

Probabilidad primer individuo tener valor mayor a 250 mil dolaes de 0.001623

Probabilidad segundo individuo salario >250 es de 0.005 

Asi sucesivamente...

```{r}
plot(sort(Wage$age), fitted1[order(Wage$age)], col=4, lwd=2, type="l", ylim=c(0, 0.2), 
     xlab="Age", ylab="Pr(Wage>250)")
```

Segun esto, donde es mucho mas probable que se ganen mas de 250 mil dolares es alrededor de los 50 años. 50 a 55 años.



