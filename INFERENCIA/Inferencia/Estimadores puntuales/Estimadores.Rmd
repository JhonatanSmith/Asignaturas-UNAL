```{r}

data("iris")

set.seed (1001)
valores.medios.long.pétalo = replicate(10000,mean(sample(iris$Petal.Length, 40, replace = TRUE)))

## Media de las medias valores longitud petalo
mean(valores.medios.long.pétalo)

## media de la variable longitud de petalo
mean(iris$Petal.Length)

##Ambas medias son muy parecidas, podemos concluir que la media muestral es un estimador puntual para la media pobliacional. 


##Observemos esto para la desviacion tipica/desv estandar. 
#Ejemplo:

#Calculando la desviacion estandar con la funcion sd...

sd(valores.medios.long.pétalo)
## Este es el valor de los datos. AHora calculemos el error estandar real.

sd(iris$Petal.Length)/sqrt(40)

##Claramente en ambos resultados son similares por tanto, el error tipico es un estimador de la desviacion tipica. 
##TODO ESTO PARA MUESTRAS CON REPOSICIONS!!
```


```{r}
##Sea una muestra aleatoria de una variable Poisson de tamaño 50 con parametro lambda=5.Calcule un estimador del parametro

set.seed(98)
muestra.poisson = rpois(50,lambda = 5)
##rpois es r=random pois = poisson, evidentemente lambda = lambda
muestra.poisson
```

```{r}
## Evidentemente lambda vale 5, pero la idea es estimar el valor de labda con las tecnicas aprendidas. Entonces intentemos ver que sucede. 

library(MASS)
fitdistr(muestra.poisson, densfun = "poisson")
```
```{r}
##4,7 es el vallor que fitdistr le dio al parametro labda y la desviacion estandar/tipica es el numero de abajo, este este caso 0.304...

##Recordemos que el estimador maximo verosimil de labda en una poisson es la media muestral, entonces haciendolo a mano tendriamos que

estimacion.lambda = mean(muestra.poisson)
estimacion.lambda
estimacion.errir.tipico = sqrt(estimacion.lambda/50)
estimacion.errir.tipico
```

## INTERVALOS DE CONFIANZA

Hallemos un intervalo de confianza para la media de la longitud del petalo para una muestra de 30 flores de la tabla de datos Iris. 

##Solucion:
Primero, calculemos la muestra:

```{r}
set.seed(1000)
muestra.iri = sample(1:150, 30, replace = TRUE)
```
A continuacion calculemos la longitud de los petalos de la muestra.

```{r}
long.petalo.muestra = iris[muestra.iri,]$Petal.Length
## Explicacion despues = De la base iris tomo [] las 30 muestras seleccionadas osea, las filas de la muestra iris, los 30 identificadores de la muestra[muestra.iris] en las filas y toomo todas las columnas [muestra.iris, ] y de las 30 muestras, saco la longitud del petalo.

```


Finalmente, in intervalo de confianza para la long del petalo seria 

```{r}
t.test(long.petalo.muestra, conf.level = .95)$conf.int
```

##INTERVALOS DE CONFIANZA PARA UN PARAMETRO "p" DE UNA BERNOULLIE

Ejemplo 1: Halle un intervalo de confianza para la proporcion de flores con especie "setosa" dada una muestra de 60 flores.

#SOLUCION:

Primero, instalamos el paquete que permite calcular IC para Bernoullies.
```{r}

library(epitools)
```

Luego, seleccionamos una muestra aleatoria simple de la base de datos iris, de tamaño 60.

```{r}
set.seed(1000)
flores.elegida = sample(1:150, 60, replace = TRUE)
```

Hay que tener en cuenta que conozco la proporcion real en este caso, que es 50/150 ya que hay 50 de cada una de las 3 tipos de flores.
Entonces Px = 1/3. Por otra parte, se pide es calcular la proporcion en la muestra de setosas. Entonces de las flores elegidas en la muestra debo de seleccionar las que sean setosas.

Ahora, el codigo anterior selecciona 60 flores pero no dice cuales ni las guarda en algun vector. Entonces
```{r}
muestras.flores.prop = iris[flores.elegida,]
#Muestra de flores elegidas para proporcion muestral. De el dataset iris, escojo las flores que ya seleccioné en la muestra, con todas sus columnas (muestra, la columna que quiero. En este caso las dejo todas). 
```

Miremos el resultado 
```{r}
head(muestras.flores.prop, 5)
```

Ahora, de la muestra anterior me interesa las que sean setosas. COntemos cuantas setosas hay.

```{r}
numero.flores.setosa = table(muestras.flores.prop$Species=="setosa")
#El table tiene como true=el valor que me interesa y false=los otros y con corchete [1] o [2] muestra cada valor
head(numero.flores.setosa)
```
Vemos claramente el valor. Hay 21 setosas. Calculemos finalmente el Intervalo de confianza.
```{r}
library(epitools)
binom.exact(numero.flores.setosa,60, conf.level = 0.95)
```
Me da 21 casos a favor, n=60, proporcion muestra=0.35 (no lejos del valor, segun esta mas) luego el IC de Clopper Pearson es (0.2313,0.484028)

## CONCLUSION   :
Segun el metodo de Clopper Pearson, en la tabla de datos iris hay un entre un 23 y un 48% de flores setosa con un 95% de confianza. 

## METODO DE WILSON

Este mismo ejercicio se puede resolver por el metodo de wilson aplicando:
```{r}
binom.wilson(numero.flores.setosa,60, conf.level = 0.95)
```
No son muy diferentes ambos analisis, aunque si hay diferencia apreciable.

# FORMULA DE LAPLACE
Para n muy grande y p lejos de los extremos.
Ejemplo: En una m.a. de 500 familias con niños en edad escolar se encontró que 340 introducían fruta de forma diaria en la dieta de sus hijos.
Calcular un IC al 95% para la proporcion real de familias de esta ciudad con niños en edad escolar que incorporan fruta de forma diaria en la dieta de sus hijos. 

#Solucion: 
En este caso, nuestra muestra es grande (n>=100) y la estimacion de la proporcionmuestral es Pgorritox= 340/500= 0.68

nPx>=10, n(1-px)>=10, podemos usar la formula de Laplace.

```{r}
binom.approx(340,500, conf.level = 0.95)
```

##Ejercicio 4

```{r}
library(epitools)
library(EnvStats)
n= 81
sigma = 36
miu= 112
alfa= 0.05
mas = rnorm(n,mean = miu, sd= sigma)
#Para miu
t.test(mas, conf.level = 1-alfa)$conf.int
#Para varianza poblacional

varTest(mas,conf.level = 1-alfa)$conf.int


```







